<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>能力评估</title>
</head>
<body>
<div>
    <h2>能力评估</h2>
    <form id="ability" >
        <button type="submit">计算能力等级并查看报告</button>
    </form>
</div>
</body>
<script>
    document.getElementById("ability").addEventListener("submit", function (event) {
        event.preventDefault();
        const id=localStorage.getItem('id');
        fetch('ass/get', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                id:id,
            })
        })
            .then(response => response.json())
            .then(data => {
                console.log('完整响应数据:', data.data);
                if (data.msg === 'success') {
                    alert("正在计算");
                    const b1=data.data.rank1;
                    const b2=data.data.rank2;
                    const b3=data.data.rank3;
                    const b4=data.data.rank4;
                    /*const b1=localStorage.getItem('b1');
                    const b2=localStorage.getItem('b2');
                    const b3=localStorage.getItem('b3');
                    const b4=localStorage.getItem('b4');*/
                    alert(b1);
                    let rank;
                    if(b1===0&&b2===0&&b3===0&&(b4===0||b4===1)){
                        rank=0;
                    }else if(b1===0&&(b2>=1||b3>=1||b4===2)){
                        rank=1;
                    }else if(b1===1&&((b2===0||b2===1)||(b3===0||b3===1)||(b4===0)||b4===1)){
                        rank=1;
                    }else if(b1===1&&((b2===2&&b3===2&&b4===2)||(b2===3||b3===3||b4===3))){
                        rank=2;
                    }else if(b1===2){
                        let count=0;
                        if(b2===1||b2===2){
                            count++;
                        }
                        if(b3===1||b3===2){
                            count++;
                        }
                        if(b4===1||b4===2){
                            count++;
                        }
                        if(count===2||count===1){
                            rank=2;
                        }
                        if(b2===2&&b3===2&&b4===2){
                            rank=3;
                        }
                        if(b2===3||b3===3||b4===3){
                            rank=3;
                        }
                    }else if(b1===3){
                        rank=3;
                    }
                    fetch("ass/add", {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            id:id,
                            rank:rank,
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.msg === 'success') {
                                alert("已完成");
                                location.href="report.html";
                            } else {
                                alert("计算失败");
                            }
                        })
                        .catch(error => {
                            alert("请求失败，请重试");
                            console.error(error);
                        });

                }
            })
            .catch(error => {
                alert("请求失败，请重试");
                console.error(error);
            });
    });
</script>
</html>